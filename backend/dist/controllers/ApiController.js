'use strict';const a8_0x4b674f=a8_0x5347;(function(_0x79ac36,_0x18b6a2){const _0x5a6b3a=a8_0x5347,_0x40c25b=_0x79ac36();while(!![]){try{const _0x3b4033=-parseInt(_0x5a6b3a(0x1ca))/0x1*(-parseInt(_0x5a6b3a(0x1e4))/0x2)+parseInt(_0x5a6b3a(0x209))/0x3+parseInt(_0x5a6b3a(0x214))/0x4*(-parseInt(_0x5a6b3a(0x1c5))/0x5)+parseInt(_0x5a6b3a(0x1c2))/0x6*(-parseInt(_0x5a6b3a(0x1fa))/0x7)+-parseInt(_0x5a6b3a(0x1ed))/0x8*(-parseInt(_0x5a6b3a(0x1b8))/0x9)+parseInt(_0x5a6b3a(0x1fc))/0xa+-parseInt(_0x5a6b3a(0x22c))/0xb*(parseInt(_0x5a6b3a(0x225))/0xc);if(_0x3b4033===_0x18b6a2)break;else _0x40c25b['push'](_0x40c25b['shift']());}catch(_0x4403a2){_0x40c25b['push'](_0x40c25b['shift']());}}}(a8_0x3ede,0x85adc));var __createBinding=this&&this['__createBinding']||(Object[a8_0x4b674f(0x1e8)]?function(_0x238461,_0x127ed,_0x4d7e46,_0x164a71){const _0x516ac8=a8_0x4b674f;if(_0x164a71===undefined)_0x164a71=_0x4d7e46;var _0x25c50d=Object['getOwnPropertyDescriptor'](_0x127ed,_0x4d7e46);(!_0x25c50d||(_0x516ac8(0x1bf)in _0x25c50d?!_0x127ed[_0x516ac8(0x219)]:_0x25c50d[_0x516ac8(0x21d)]||_0x25c50d[_0x516ac8(0x1f5)]))&&(_0x25c50d={'enumerable':!![],'get':function(){return _0x127ed[_0x4d7e46];}}),Object[_0x516ac8(0x1f0)](_0x238461,_0x164a71,_0x25c50d);}:function(_0x10acdb,_0x3d7666,_0x167874,_0x3e1582){if(_0x3e1582===undefined)_0x3e1582=_0x167874;_0x10acdb[_0x3e1582]=_0x3d7666[_0x167874];}),__setModuleDefault=this&&this[a8_0x4b674f(0x1f1)]||(Object[a8_0x4b674f(0x1e8)]?function(_0x32c25d,_0x4b29d4){const _0x5f27b5=a8_0x4b674f;Object[_0x5f27b5(0x1f0)](_0x32c25d,_0x5f27b5(0x1f6),{'enumerable':!![],'value':_0x4b29d4});}:function(_0x278765,_0x1c0f6d){const _0x3dba8e=a8_0x4b674f;_0x278765[_0x3dba8e(0x1f6)]=_0x1c0f6d;}),__importStar=this&&this[a8_0x4b674f(0x1ef)]||function(_0x2ab67e){const _0x2a9763=a8_0x4b674f;if(_0x2ab67e&&_0x2ab67e[_0x2a9763(0x219)])return _0x2ab67e;var _0x3e5ad4={};if(_0x2ab67e!=null){for(var _0x31ee39 in _0x2ab67e)if(_0x31ee39!==_0x2a9763(0x1f6)&&Object['prototype'][_0x2a9763(0x201)][_0x2a9763(0x21b)](_0x2ab67e,_0x31ee39))__createBinding(_0x3e5ad4,_0x2ab67e,_0x31ee39);}return __setModuleDefault(_0x3e5ad4,_0x2ab67e),_0x3e5ad4;},__importDefault=this&&this['__importDefault']||function(_0x276994){const _0x380e62=a8_0x4b674f;return _0x276994&&_0x276994[_0x380e62(0x219)]?_0x276994:{'default':_0x276994};};function a8_0x3ede(){const _0x24b72a=['defineProperty','__setModuleDefault','mimetype','findByPk','getWbot','configurable','default','findOne','usedCheckNumber','json','891947hMmUJz','pdf','4606600BFRXce','sendMessage','resolve','checkNumber','isInteger','hasOwnProperty','isGroup','../errors/AppError','../helpers/SetTicketMessagesAsRead','../services/WbotServices/CheckNumber','../models/Contact','public','dataValues','2745579ptIZxu','all','company','indexWhatsappsId','string','../services/TicketServices/FindOrCreateTicketService','authorization','test','SUCCESS','isNil','usedVideo','625572nCjKhm','usedOther','indexImage','getMessageOptions','index','__esModule','g.us','call','s.whatsapp.net','writable','../utils/useDate','shape','object','\x20not\x20found','@g.us','usedImage','body','12nSctHE','UsedOnDay','required','send','matches','video','OnWhatsAppDto','1179398NMRkwQ','../services/WbotServices/SendWhatsAppMedia','moment','files','status','18EvgRPO','unlinkSync','../services/UserServices/ShowUserService','path','name','../services/WbotServices/SendWhatsAppMessageAPI','verifyMediaMessage','get','exists','existsSync','30QxFOYu','yup','@s.whatsapp.net','15NoUNTE','format','update','Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.','split','359vgiXPN','trim','onWhatsApp','../services/TicketServices/UpdateTicketService','../models/CompaniesSettings','../services/WbotServices/CheckIsValidContact','../services/WbotServices/wbotMessageListener','usedPDF','useDate','headers','closed','../services/QueueService/ShowQueueService','Cliente\x20em\x20outro\x20atendimento','url','validate','parseInt','../models/Whatsapp','join','whatsapp\x20#','contact','message','../libs/wbot','image','usedText','replace','../services/WbotServices/SendWhatsappMediaImage','578qEqOSl','toString',':*\x0a','number','create','companyId','map','jid','includes','1125784dNkRTS','filename','__importStar'];a8_0x3ede=function(){return _0x24b72a;};return a8_0x3ede();}Object['defineProperty'](exports,a8_0x4b674f(0x219),{'value':!![]}),exports[a8_0x4b674f(0x20c)]=exports[a8_0x4b674f(0x1ff)]=exports['indexImage']=exports['index']=exports['indexLink']=exports[a8_0x4b674f(0x22b)]=void 0x0;const Yup=__importStar(require(a8_0x4b674f(0x1c3))),fs_1=__importDefault(require('fs')),AppError_1=__importDefault(require(a8_0x4b674f(0x203))),GetDefaultWhatsApp_1=__importDefault(require('../helpers/GetDefaultWhatsApp')),SetTicketMessagesAsRead_1=__importDefault(require(a8_0x4b674f(0x204))),Whatsapp_1=__importDefault(require(a8_0x4b674f(0x1da))),CreateOrUpdateContactService_1=__importDefault(require('../services/ContactServices/CreateOrUpdateContactService')),FindOrCreateTicketService_1=__importDefault(require(a8_0x4b674f(0x20e))),CheckIsValidContact_1=__importDefault(require(a8_0x4b674f(0x1cf))),CheckNumber_1=__importDefault(require(a8_0x4b674f(0x205))),SendWhatsAppMedia_1=__importStar(require(a8_0x4b674f(0x22d))),UpdateTicketService_1=__importDefault(require(a8_0x4b674f(0x1cd))),wbot_1=require(a8_0x4b674f(0x1df)),SendWhatsAppMessageLink_1=__importDefault(require('../services/WbotServices/SendWhatsAppMessageLink')),SendWhatsAppMessageAPI_1=__importDefault(require(a8_0x4b674f(0x1bd))),SendWhatsappMediaImage_1=__importDefault(require(a8_0x4b674f(0x1e3))),ApiUsages_1=__importDefault(require('../models/ApiUsages')),useDate_1=require(a8_0x4b674f(0x21e)),moment_1=__importDefault(require(a8_0x4b674f(0x22e))),CompaniesSettings_1=__importDefault(require(a8_0x4b674f(0x1ce))),ShowUserService_1=__importDefault(require(a8_0x4b674f(0x1ba))),lodash_1=require('lodash'),wbotMessageListener_1=require(a8_0x4b674f(0x1d0)),ShowQueueService_1=__importDefault(require(a8_0x4b674f(0x1d5))),path_1=__importDefault(require(a8_0x4b674f(0x1bb))),Contact_1=__importDefault(require(a8_0x4b674f(0x206)));class OnWhatsAppDto{constructor(_0x219c35,_0x40f8be){const _0x2b6505=a8_0x4b674f;this[_0x2b6505(0x1eb)]=_0x219c35,this[_0x2b6505(0x1c0)]=_0x40f8be;}}exports[a8_0x4b674f(0x22b)]=OnWhatsAppDto;const createContact=async(_0x55621c,_0xbc058b,_0x5a5ebd,_0x53f34f,_0x22b424)=>{const _0x15c3d5=a8_0x4b674f;await(0x0,CheckIsValidContact_1[_0x15c3d5(0x1f6)])(_0x5a5ebd,_0xbc058b);const _0x8b6bd2=await(0x0,CheckNumber_1[_0x15c3d5(0x1f6)])(_0x5a5ebd,_0xbc058b),_0x4b9e73=_0x8b6bd2,_0x4f2c45={'name':''+_0x4b9e73,'number':_0x4b9e73,'profilePicUrl':'','isGroup':![],'companyId':_0xbc058b,'whatsappId':_0x55621c},_0x5b10fd=await(0x0,CreateOrUpdateContactService_1[_0x15c3d5(0x1f6)])(_0x4f2c45),_0x59ea05=await CompaniesSettings_1[_0x15c3d5(0x1f6)][_0x15c3d5(0x1f7)]({'where':{'companyId':_0xbc058b}});let _0x43650b;if(_0x55621c===undefined)_0x43650b=await(0x0,GetDefaultWhatsApp_1[_0x15c3d5(0x1f6)])(_0xbc058b);else{_0x43650b=await Whatsapp_1[_0x15c3d5(0x1f6)][_0x15c3d5(0x1f3)](_0x55621c);if(_0x43650b===null)throw new AppError_1[(_0x15c3d5(0x1f6))](_0x15c3d5(0x1dc)+_0x55621c+_0x15c3d5(0x221));}const {ticket:_0x16deab,isCreated:_0x2c9d2b}=await(0x0,FindOrCreateTicketService_1[_0x15c3d5(0x1f6)])(_0x5b10fd,_0x43650b,0x0,_0xbc058b,_0x22b424,_0x53f34f,null,'whatsapp',null,![],_0x59ea05);return _0x16deab&&(0x0,SetTicketMessagesAsRead_1['default'])(_0x16deab),_0x16deab;};function formatBRNumber(_0x3de8bf){const _0xd2a6db=a8_0x4b674f,_0x1c4f0b=new RegExp(/^(\d{2})(\d{2})\d{1}(\d{8})$/);if(_0x1c4f0b[_0xd2a6db(0x210)](_0x3de8bf)){const _0x1e5c27=_0x1c4f0b['exec'](_0x3de8bf);if(_0x1e5c27&&_0x1e5c27[0x1]==='55'&&Number[_0xd2a6db(0x200)](Number['parseInt'](_0x1e5c27[0x2]))){const _0x41b13a=Number[_0xd2a6db(0x1d9)](_0x1e5c27[0x2]);if(_0x41b13a<0x1f)return _0x1e5c27[0x0];else{if(_0x41b13a>=0x1f)return _0x1e5c27[0x1]+_0x1e5c27[0x2]+_0x1e5c27[0x3];}}}else return _0x3de8bf;}function createJid(_0x3ac09c){const _0x43e542=a8_0x4b674f;if(_0x3ac09c[_0x43e542(0x1ec)](_0x43e542(0x222))||_0x3ac09c['includes'](_0x43e542(0x1c4)))return formatBRNumber(_0x3ac09c);return _0x3ac09c[_0x43e542(0x1ec)]('-')?_0x3ac09c+_0x43e542(0x222):formatBRNumber(_0x3ac09c)+'@s.whatsapp.net';}const indexLink=async(_0x29575b,_0x524964)=>{const _0x1da1ed=a8_0x4b674f,_0x4225c5=_0x29575b[_0x1da1ed(0x224)],{whatsappId:_0xac36f2}=_0x29575b[_0x1da1ed(0x224)],{msdelay:_0x5a7ef4}=_0x29575b[_0x1da1ed(0x224)],_0x1d5640=_0x29575b[_0x1da1ed(0x224)][_0x1da1ed(0x1d7)],_0xfd467e=_0x29575b[_0x1da1ed(0x224)]['caption'],_0x45e6be=_0x29575b[_0x1da1ed(0x1d3)][_0x1da1ed(0x20f)],[,_0x573df2]=_0x45e6be['split']('\x20'),_0x381518=await Whatsapp_1[_0x1da1ed(0x1f6)][_0x1da1ed(0x1f7)]({'where':{'token':_0x573df2}}),_0x46de24=_0x381518[_0x1da1ed(0x1e9)];_0x4225c5[_0x1da1ed(0x1e7)]=_0x4225c5[_0x1da1ed(0x1e7)]['replace']('-','')['replace']('\x20','');const _0x31798a=Yup[_0x1da1ed(0x220)]()[_0x1da1ed(0x21f)]({'number':Yup['string']()[_0x1da1ed(0x227)]()['matches'](/^\d+$/,_0x1da1ed(0x1c8))});try{await _0x31798a[_0x1da1ed(0x1d8)](_0x4225c5);}catch(_0x3be64e){throw new AppError_1[(_0x1da1ed(0x1f6))](_0x3be64e[_0x1da1ed(0x1de)]);}const _0x21b3dd=await createContact(_0xac36f2,_0x46de24,_0x4225c5[_0x1da1ed(0x1e7)]);if(!_0x21b3dd)throw new AppError_1[(_0x1da1ed(0x1f6))](_0x1da1ed(0x1d6));return await(0x0,SendWhatsAppMessageLink_1[_0x1da1ed(0x1f6)])({'whatsappId':_0xac36f2,'contact':_0x21b3dd[_0x1da1ed(0x1dd)],'url':_0x1d5640,'caption':_0xfd467e,'msdelay':_0x5a7ef4}),setTimeout(async()=>{const _0x5c44c8=_0x1da1ed,{dateToClient:_0x5bfc0f}=(0x0,useDate_1[_0x5c44c8(0x1d2)])(),_0x1ead70=_0x5bfc0f(new Date()),_0x1b5ee4=(0x0,moment_1[_0x5c44c8(0x1f6)])()[_0x5c44c8(0x1c6)](),_0xdd8de6=await ApiUsages_1['default'][_0x5c44c8(0x1f7)]({'where':{'dateUsed':_0x1ead70,'companyId':_0x46de24}});if(_0xdd8de6)await _0xdd8de6[_0x5c44c8(0x1c7)]({'usedPDF':_0xdd8de6[_0x5c44c8(0x208)][_0x5c44c8(0x1d1)]+0x1,'UsedOnDay':_0xdd8de6[_0x5c44c8(0x208)]['UsedOnDay']+0x1,'updatedAt':_0x1b5ee4});else{const _0x3293ef=await ApiUsages_1[_0x5c44c8(0x1f6)][_0x5c44c8(0x1e8)]({'companyId':_0x46de24,'dateUsed':_0x1ead70});await _0x3293ef[_0x5c44c8(0x1c7)]({'usedPDF':_0x3293ef[_0x5c44c8(0x208)][_0x5c44c8(0x1d1)]+0x1,'UsedOnDay':_0x3293ef[_0x5c44c8(0x208)]['UsedOnDay']+0x1,'updatedAt':_0x1b5ee4});}},0x64),_0x524964[_0x1da1ed(0x228)]({'status':_0x1da1ed(0x211)});};exports['indexLink']=indexLink;const index=async(_0x2d3865,_0x250f6d)=>{const _0x1eab25=a8_0x4b674f,_0x314f64=_0x2d3865[_0x1eab25(0x224)],{whatsappId:_0x501901}=_0x2d3865['body'],{msdelay:_0x34eebb}=_0x2d3865[_0x1eab25(0x224)],{number:_0x4dd851,body:_0x18d841,quotedMsg:_0x8d7237,userId:_0x2ed87b,queueId:_0x56e6c9,sendSignature:sendSignature=![],closeTicket:closeTicket=![],noRegister:noRegister=![]}=_0x2d3865['body'],_0x4512d3=_0x2d3865[_0x1eab25(0x1b6)],_0x34f3d7=_0x2d3865[_0x1eab25(0x1d3)][_0x1eab25(0x20f)],[,_0x877aed]=_0x34f3d7[_0x1eab25(0x1c9)]('\x20'),_0x465678=await Whatsapp_1[_0x1eab25(0x1f6)][_0x1eab25(0x1f7)]({'where':{'token':_0x877aed}}),_0x357c87=_0x465678[_0x1eab25(0x1e9)];_0x314f64[_0x1eab25(0x1e7)]=_0x314f64[_0x1eab25(0x1e7)][_0x1eab25(0x1e2)]('-','')[_0x1eab25(0x1e2)]('\x20','');const _0x508139=Yup[_0x1eab25(0x220)]()[_0x1eab25(0x21f)]({'number':Yup[_0x1eab25(0x20d)]()[_0x1eab25(0x227)]()[_0x1eab25(0x229)](/^\d+$/,_0x1eab25(0x1c8))});try{await _0x508139[_0x1eab25(0x1d8)](_0x314f64);}catch(_0x228829){throw new AppError_1[(_0x1eab25(0x1f6))](_0x228829[_0x1eab25(0x1de)]);}const _0x5435a1=await(0x0,wbot_1[_0x1eab25(0x1f4)])(_0x465678['id']);let _0x2e88e6;_0x2ed87b?.[_0x1eab25(0x1e5)]()!==''&&!isNaN(_0x2ed87b)&&(_0x2e88e6=await(0x0,ShowUserService_1[_0x1eab25(0x1f6)])(_0x2ed87b,_0x357c87));let _0x7d8807;_0x56e6c9?.[_0x1eab25(0x1e5)]()!==''&&!isNaN(_0x56e6c9)&&(_0x7d8807=await(0x0,ShowQueueService_1[_0x1eab25(0x1f6)])(_0x56e6c9,_0x357c87));let _0x4afd8f;sendSignature&&!(0x0,lodash_1[_0x1eab25(0x212)])(_0x2e88e6)?_0x4afd8f='*'+_0x2e88e6[_0x1eab25(0x1bc)]+_0x1eab25(0x1e6)+_0x18d841[_0x1eab25(0x1cb)]():_0x4afd8f=_0x18d841[_0x1eab25(0x1cb)]();let _0x38c2c0=await Contact_1['default'][_0x1eab25(0x1f7)]({'where':{'number':_0x314f64[_0x1eab25(0x1e7)],'companyId':_0x357c87}});if(!_0x38c2c0){const _0x520a39={'name':''+_0x4dd851,'number':_0x4dd851,'profilePicUrl':'','isGroup':![],'companyId':_0x357c87,'whatsappId':_0x465678['id']};_0x38c2c0=await(0x0,CreateOrUpdateContactService_1[_0x1eab25(0x1f6)])(_0x520a39);}if(noRegister)_0x4512d3?await Promise['all'](_0x4512d3[_0x1eab25(0x1ea)](async _0x4633d9=>{const _0x5a89ea=_0x1eab25,_0x55462f=path_1[_0x5a89ea(0x1f6)][_0x5a89ea(0x1fe)](__dirname,'..','..',_0x5a89ea(0x207)),_0x2c12c6=path_1['default'][_0x5a89ea(0x1db)](_0x55462f,_0x5a89ea(0x20b)+_0x357c87,_0x4633d9[_0x5a89ea(0x1ee)]),_0x21033a=await(0x0,SendWhatsAppMedia_1[_0x5a89ea(0x217)])(_0x4633d9[_0x5a89ea(0x1ee)],_0x2c12c6,_0x357c87[_0x5a89ea(0x1e5)](),_0x4afd8f);await _0x5435a1[_0x5a89ea(0x1fd)](_0x38c2c0[_0x5a89ea(0x1e7)]+'@'+(_0x38c2c0[_0x5a89ea(0x202)]?'g.us':_0x5a89ea(0x21c)),_0x21033a);const _0x542ddb=fs_1[_0x5a89ea(0x1f6)][_0x5a89ea(0x1c1)](_0x2c12c6);_0x542ddb&&fs_1[_0x5a89ea(0x1f6)][_0x5a89ea(0x1b9)](_0x2c12c6);})):await _0x5435a1[_0x1eab25(0x1fd)](_0x38c2c0[_0x1eab25(0x1e7)]+'@'+(_0x38c2c0[_0x1eab25(0x202)]?_0x1eab25(0x21a):_0x1eab25(0x21c)),{'text':_0x4afd8f});else{const _0x5a7454=await createContact(_0x465678['id'],_0x357c87,_0x314f64[_0x1eab25(0x1e7)],_0x2ed87b,_0x56e6c9);let _0x340582;_0x4512d3?(await Promise['all'](_0x4512d3['map'](async _0x4e208e=>{const _0x5e39c1=_0x1eab25;_0x340582=await(0x0,SendWhatsAppMedia_1[_0x5e39c1(0x1f6)])({'body':'‎\x20'+_0x4afd8f,'media':_0x4e208e,'ticket':_0x5a7454,'isForwarded':![]});const _0x2ae3c5=path_1[_0x5e39c1(0x1f6)][_0x5e39c1(0x1fe)](__dirname,'..','..',_0x5e39c1(0x207)),_0x277a77=path_1['default']['join'](_0x2ae3c5,'company'+_0x357c87,_0x4e208e['filename']),_0x38ff33=fs_1[_0x5e39c1(0x1f6)][_0x5e39c1(0x1c1)](_0x277a77);_0x38ff33&&fs_1[_0x5e39c1(0x1f6)][_0x5e39c1(0x1b9)](_0x277a77);})),await(0x0,wbotMessageListener_1[_0x1eab25(0x1be)])(_0x340582,_0x5a7454,_0x5a7454[_0x1eab25(0x1dd)])):(_0x340582=await(0x0,SendWhatsAppMessageAPI_1['default'])({'body':'‎\x20'+_0x4afd8f,'whatsappId':_0x465678['id'],'contact':_0x5a7454[_0x1eab25(0x1dd)],'quotedMsg':_0x8d7237,'msdelay':_0x34eebb}),await(0x0,wbotMessageListener_1['verifyMessage'])(_0x340582,_0x5a7454,_0x5a7454[_0x1eab25(0x1dd)]));if(closeTicket)setTimeout(async()=>{const _0x41e046=_0x1eab25;await(0x0,UpdateTicketService_1[_0x41e046(0x1f6)])({'ticketId':_0x5a7454['id'],'ticketData':{'status':_0x41e046(0x1d4),'sendFarewellMessage':![],'amountUsedBotQueues':0x0,'lastMessage':_0x18d841},'companyId':_0x357c87});},0x64);else _0x2ed87b?.[_0x1eab25(0x1e5)]()!==''&&!isNaN(_0x2ed87b)&&setTimeout(async()=>{const _0x3bbaae=_0x1eab25;await(0x0,UpdateTicketService_1[_0x3bbaae(0x1f6)])({'ticketId':_0x5a7454['id'],'ticketData':{'status':'open','amountUsedBotQueues':0x0,'lastMessage':_0x18d841,'userId':_0x2ed87b,'queueId':_0x56e6c9},'companyId':_0x357c87});},0x64);}return setTimeout(async()=>{const _0x11c735=_0x1eab25,{dateToClient:_0x917489}=(0x0,useDate_1[_0x11c735(0x1d2)])(),_0x5df8c7=_0x917489(new Date()),_0x2ad1ac=(0x0,moment_1[_0x11c735(0x1f6)])()['format']();let _0x5396a4=await ApiUsages_1[_0x11c735(0x1f6)][_0x11c735(0x1f7)]({'where':{'dateUsed':_0x5df8c7,'companyId':_0x357c87}});_0x5396a4?_0x4512d3?await Promise[_0x11c735(0x20a)](_0x4512d3[_0x11c735(0x1ea)](async _0x1d5f98=>{const _0x5318de=_0x11c735;if(_0x1d5f98[_0x5318de(0x1f2)]['includes']('pdf'))await _0x5396a4[_0x5318de(0x1c7)]({'usedPDF':_0x5396a4['dataValues'][_0x5318de(0x1d1)]+0x1,'UsedOnDay':_0x5396a4[_0x5318de(0x208)]['UsedOnDay']+0x1,'updatedAt':_0x2ad1ac});else{if(_0x1d5f98[_0x5318de(0x1f2)]['includes'](_0x5318de(0x1e0)))await _0x5396a4[_0x5318de(0x1c7)]({'usedImage':_0x5396a4[_0x5318de(0x208)]['usedImage']+0x1,'UsedOnDay':_0x5396a4[_0x5318de(0x208)][_0x5318de(0x226)]+0x1,'updatedAt':_0x2ad1ac});else _0x1d5f98['mimetype']['includes'](_0x5318de(0x22a))?await _0x5396a4[_0x5318de(0x1c7)]({'usedVideo':_0x5396a4['dataValues'][_0x5318de(0x213)]+0x1,'UsedOnDay':_0x5396a4['dataValues'][_0x5318de(0x226)]+0x1,'updatedAt':_0x2ad1ac}):await _0x5396a4[_0x5318de(0x1c7)]({'usedOther':_0x5396a4['dataValues'][_0x5318de(0x215)]+0x1,'UsedOnDay':_0x5396a4[_0x5318de(0x208)][_0x5318de(0x226)]+0x1,'updatedAt':_0x2ad1ac});}})):await _0x5396a4[_0x11c735(0x1c7)]({'usedText':_0x5396a4[_0x11c735(0x208)][_0x11c735(0x1e1)]+0x1,'UsedOnDay':_0x5396a4[_0x11c735(0x208)][_0x11c735(0x226)]+0x1,'updatedAt':_0x2ad1ac}):(_0x5396a4=await ApiUsages_1[_0x11c735(0x1f6)][_0x11c735(0x1e8)]({'companyId':_0x357c87,'dateUsed':_0x5df8c7}),_0x4512d3?await Promise[_0x11c735(0x20a)](_0x4512d3['map'](async _0x1cdca3=>{const _0x36be00=_0x11c735;if(_0x1cdca3[_0x36be00(0x1f2)][_0x36be00(0x1ec)](_0x36be00(0x1fb)))await _0x5396a4['update']({'usedPDF':_0x5396a4[_0x36be00(0x208)][_0x36be00(0x1d1)]+0x1,'UsedOnDay':_0x5396a4[_0x36be00(0x208)][_0x36be00(0x226)]+0x1,'updatedAt':_0x2ad1ac});else{if(_0x1cdca3[_0x36be00(0x1f2)]['includes'](_0x36be00(0x1e0)))await _0x5396a4[_0x36be00(0x1c7)]({'usedImage':_0x5396a4[_0x36be00(0x208)]['usedImage']+0x1,'UsedOnDay':_0x5396a4[_0x36be00(0x208)][_0x36be00(0x226)]+0x1,'updatedAt':_0x2ad1ac});else _0x1cdca3[_0x36be00(0x1f2)]['includes']('video')?await _0x5396a4[_0x36be00(0x1c7)]({'usedVideo':_0x5396a4[_0x36be00(0x208)][_0x36be00(0x213)]+0x1,'UsedOnDay':_0x5396a4['dataValues'][_0x36be00(0x226)]+0x1,'updatedAt':_0x2ad1ac}):await _0x5396a4['update']({'usedOther':_0x5396a4[_0x36be00(0x208)][_0x36be00(0x215)]+0x1,'UsedOnDay':_0x5396a4[_0x36be00(0x208)]['UsedOnDay']+0x1,'updatedAt':_0x2ad1ac});}})):await _0x5396a4[_0x11c735(0x1c7)]({'usedText':_0x5396a4['dataValues'][_0x11c735(0x1e1)]+0x1,'UsedOnDay':_0x5396a4[_0x11c735(0x208)][_0x11c735(0x226)]+0x1,'updatedAt':_0x2ad1ac}));},0x64),_0x250f6d['send']({'status':'SUCCESS'});};exports[a8_0x4b674f(0x218)]=index;const indexImage=async(_0x5bcaf2,_0x2c577f)=>{const _0x11f523=a8_0x4b674f,_0x42d31e=_0x5bcaf2[_0x11f523(0x224)],{whatsappId:_0x2f1415}=_0x5bcaf2[_0x11f523(0x224)],{msdelay:_0x238b06}=_0x5bcaf2[_0x11f523(0x224)],_0x1fb77b=_0x5bcaf2['body'][_0x11f523(0x1d7)],_0x357532=_0x5bcaf2[_0x11f523(0x224)]['caption'],_0x4e210c=_0x5bcaf2[_0x11f523(0x1d3)][_0x11f523(0x20f)],[,_0x40c3de]=_0x4e210c['split']('\x20'),_0x216657=await Whatsapp_1[_0x11f523(0x1f6)][_0x11f523(0x1f7)]({'where':{'token':_0x40c3de}}),_0x898495=_0x216657['companyId'];_0x42d31e[_0x11f523(0x1e7)]=_0x42d31e[_0x11f523(0x1e7)][_0x11f523(0x1e2)]('-','')[_0x11f523(0x1e2)]('\x20','');const _0x197a04=Yup[_0x11f523(0x220)]()[_0x11f523(0x21f)]({'number':Yup[_0x11f523(0x20d)]()[_0x11f523(0x227)]()[_0x11f523(0x229)](/^\d+$/,'Invalid\x20number\x20format.\x20Only\x20numbers\x20is\x20allowed.')});try{await _0x197a04[_0x11f523(0x1d8)](_0x42d31e);}catch(_0x32aa39){throw new AppError_1[(_0x11f523(0x1f6))](_0x32aa39[_0x11f523(0x1de)]);}const _0x19d920=await createContact(_0x2f1415,_0x898495,_0x42d31e['number']);return _0x1fb77b&&await(0x0,SendWhatsappMediaImage_1[_0x11f523(0x1f6)])({'ticket':_0x19d920,'url':_0x1fb77b,'caption':_0x357532,'msdelay':_0x238b06}),setTimeout(async()=>{const _0x3dc51d=_0x11f523;await(0x0,UpdateTicketService_1[_0x3dc51d(0x1f6)])({'ticketId':_0x19d920['id'],'ticketData':{'status':_0x3dc51d(0x1d4),'sendFarewellMessage':![],'amountUsedBotQueues':0x0},'companyId':_0x898495});},0x64),setTimeout(async()=>{const _0xb4005=_0x11f523,{dateToClient:_0xe99658}=(0x0,useDate_1[_0xb4005(0x1d2)])(),_0xf78eec=_0xe99658(new Date()),_0x135040=(0x0,moment_1[_0xb4005(0x1f6)])()['format'](),_0x5b7e9e=await ApiUsages_1['default'][_0xb4005(0x1f7)]({'where':{'dateUsed':_0xf78eec,'companyId':_0x898495}});if(_0x5b7e9e)await _0x5b7e9e[_0xb4005(0x1c7)]({'usedImage':_0x5b7e9e['dataValues'][_0xb4005(0x223)]+0x1,'UsedOnDay':_0x5b7e9e[_0xb4005(0x208)]['UsedOnDay']+0x1,'updatedAt':_0x135040});else{const _0xbc0374=await ApiUsages_1[_0xb4005(0x1f6)][_0xb4005(0x1e8)]({'companyId':_0x898495,'dateUsed':_0xf78eec});await _0xbc0374[_0xb4005(0x1c7)]({'usedImage':_0xbc0374[_0xb4005(0x208)][_0xb4005(0x223)]+0x1,'UsedOnDay':_0xbc0374[_0xb4005(0x208)][_0xb4005(0x226)]+0x1,'updatedAt':_0x135040});}},0x64),_0x2c577f[_0x11f523(0x228)]({'status':_0x11f523(0x211)});};exports[a8_0x4b674f(0x216)]=indexImage;function a8_0x5347(_0x30aa28,_0x334611){const _0x3ede97=a8_0x3ede();return a8_0x5347=function(_0x534717,_0x5e0885){_0x534717=_0x534717-0x1b6;let _0x533f30=_0x3ede97[_0x534717];return _0x533f30;},a8_0x5347(_0x30aa28,_0x334611);}const checkNumber=async(_0x121329,_0x158bdd)=>{const _0x366133=a8_0x4b674f,_0x3561cd=_0x121329[_0x366133(0x224)],_0x48b646=_0x121329[_0x366133(0x1d3)]['authorization'],[,_0x55d442]=_0x48b646[_0x366133(0x1c9)]('\x20'),_0x2d821f=await Whatsapp_1[_0x366133(0x1f6)][_0x366133(0x1f7)]({'where':{'token':_0x55d442}}),_0x4c3043=_0x2d821f[_0x366133(0x1e9)],_0x2190cb=_0x3561cd['number'][_0x366133(0x1e2)]('-','')[_0x366133(0x1e2)]('\x20',''),_0x18e0de=await(0x0,GetDefaultWhatsApp_1[_0x366133(0x1f6)])(_0x4c3043),_0x7378=(0x0,wbot_1['getWbot'])(_0x18e0de['id']),_0x4b6751=createJid(_0x2190cb);try{const [_0x53ec8a]=await _0x7378[_0x366133(0x1cc)](_0x4b6751);if(_0x53ec8a[_0x366133(0x1c0)])return setTimeout(async()=>{const _0x539b4c=_0x366133,{dateToClient:_0x44d2f7}=(0x0,useDate_1[_0x539b4c(0x1d2)])(),_0x479965=_0x44d2f7(new Date()),_0x226589=(0x0,moment_1['default'])()['format'](),_0x566a83=await ApiUsages_1[_0x539b4c(0x1f6)][_0x539b4c(0x1f7)]({'where':{'dateUsed':_0x479965,'companyId':_0x4c3043}});if(_0x566a83)await _0x566a83[_0x539b4c(0x1c7)]({'usedCheckNumber':_0x566a83[_0x539b4c(0x208)][_0x539b4c(0x1f8)]+0x1,'UsedOnDay':_0x566a83[_0x539b4c(0x208)][_0x539b4c(0x226)]+0x1,'updatedAt':_0x226589});else{const _0x524661=await ApiUsages_1[_0x539b4c(0x1f6)][_0x539b4c(0x1e8)]({'companyId':_0x4c3043,'dateUsed':_0x479965});await _0x524661[_0x539b4c(0x1c7)]({'usedCheckNumber':_0x524661[_0x539b4c(0x208)]['usedCheckNumber']+0x1,'UsedOnDay':_0x524661['dataValues'][_0x539b4c(0x226)]+0x1,'updatedAt':_0x226589});}},0x64),_0x158bdd[_0x366133(0x1b7)](0xc8)[_0x366133(0x1f9)]({'existsInWhatsapp':!![],'number':_0x2190cb,'numberFormatted':_0x53ec8a[_0x366133(0x1eb)]});}catch(_0x3f619f){return _0x158bdd[_0x366133(0x1b7)](0x190)[_0x366133(0x1f9)]({'existsInWhatsapp':![],'number':_0x4b6751,'error':'Not\x20exists\x20on\x20Whatsapp'});}};exports[a8_0x4b674f(0x1ff)]=checkNumber;const indexWhatsappsId=async(_0x1acc69,_0x1c608b)=>{const _0x2ffabd=a8_0x4b674f;return _0x1c608b['status'](0xc8)[_0x2ffabd(0x1f9)]('oi');};exports['indexWhatsappsId']=indexWhatsappsId;