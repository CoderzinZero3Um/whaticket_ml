'use strict';const a672_0x373c52=a672_0x41a0;function a672_0x43ca(){const _0x324b83=['1868dLTTTQ','null','4665486QmKBNB','key','*\x20*\x20*\x20*\x20*','default','__importStar','logger','SELECT','bull','hasOwnProperty','UserMonitor','QueryTypes','873loEcgC','save','getOwnPropertyDescriptor','captureException','info','./database','./utils/logger','lodash','4049240ongned','@sentry/node','UserConnection','update','configurable','userMonitor','query','online','__esModule','select\x20id\x20from\x20\x22Users\x22\x20where\x20\x22updatedAt\x22\x20<\x20now()\x20-\x20\x275\x20minutes\x27::interval\x20and\x20online\x20=\x20true','sequelize','VerifyLoginStatus','findByPk','defineProperty','__importDefault','__createBinding','./models/User','2251172CXPfgY','get','data','289555dSceKl','3075759PRuaRA','process','1175915QTOCbD','Usuário\x20passado\x20para\x20offline:\x20','create','env','4SFtkyB','getRepeatableJobs','removeRepeatableByKey','initUserMonitorQueues'];a672_0x43ca=function(){return _0x324b83;};return a672_0x43ca();}(function(_0x3d3b34,_0x90f822){const _0x551d32=a672_0x41a0,_0x1c1dd5=_0x3d3b34();while(!![]){try{const _0x320a9b=parseInt(_0x551d32(0x9f))/0x1+parseInt(_0x551d32(0xaa))/0x2*(parseInt(_0x551d32(0xb7))/0x3)+-parseInt(_0x551d32(0xa6))/0x4*(-parseInt(_0x551d32(0xa2))/0x5)+parseInt(_0x551d32(0xac))/0x6+-parseInt(_0x551d32(0x9c))/0x7+-parseInt(_0x551d32(0xbf))/0x8+-parseInt(_0x551d32(0xa0))/0x9;if(_0x320a9b===_0x90f822)break;else _0x1c1dd5['push'](_0x1c1dd5['shift']());}catch(_0x1fb771){_0x1c1dd5['push'](_0x1c1dd5['shift']());}}}(a672_0x43ca,0x62c83));var __createBinding=this&&this[a672_0x373c52(0x9a)]||(Object[a672_0x373c52(0xa4)]?function(_0x5a2a58,_0x412cdf,_0x44ec2b,_0x1fe14c){const _0x2b16e0=a672_0x373c52;if(_0x1fe14c===undefined)_0x1fe14c=_0x44ec2b;var _0x7773c=Object[_0x2b16e0(0xb9)](_0x412cdf,_0x44ec2b);(!_0x7773c||(_0x2b16e0(0x9d)in _0x7773c?!_0x412cdf[_0x2b16e0(0x93)]:_0x7773c['writable']||_0x7773c[_0x2b16e0(0xc3)]))&&(_0x7773c={'enumerable':!![],'get':function(){return _0x412cdf[_0x44ec2b];}}),Object['defineProperty'](_0x5a2a58,_0x1fe14c,_0x7773c);}:function(_0x421a15,_0x5e8541,_0x50cce1,_0x572164){if(_0x572164===undefined)_0x572164=_0x50cce1;_0x421a15[_0x572164]=_0x5e8541[_0x50cce1];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a672_0x373c52(0xa4)]?function(_0x2d4d48,_0x3fbdc7){const _0x455d3e=a672_0x373c52;Object[_0x455d3e(0x98)](_0x2d4d48,_0x455d3e(0xaf),{'enumerable':!![],'value':_0x3fbdc7});}:function(_0x202861,_0x726df6){_0x202861['default']=_0x726df6;}),__importStar=this&&this[a672_0x373c52(0xb0)]||function(_0x1065a2){const _0x4383b6=a672_0x373c52;if(_0x1065a2&&_0x1065a2[_0x4383b6(0x93)])return _0x1065a2;var _0xb4e084={};if(_0x1065a2!=null){for(var _0x1ab4fe in _0x1065a2)if(_0x1ab4fe!==_0x4383b6(0xaf)&&Object['prototype'][_0x4383b6(0xb4)]['call'](_0x1065a2,_0x1ab4fe))__createBinding(_0xb4e084,_0x1065a2,_0x1ab4fe);}return __setModuleDefault(_0xb4e084,_0x1065a2),_0xb4e084;},__importDefault=this&&this[a672_0x373c52(0x99)]||function(_0x1e842f){return _0x1e842f&&_0x1e842f['__esModule']?_0x1e842f:{'default':_0x1e842f};};function a672_0x41a0(_0x1443fe,_0x13d97a){const _0x43caac=a672_0x43ca();return a672_0x41a0=function(_0x41a09a,_0x88def0){_0x41a09a=_0x41a09a-0x90;let _0x3b098e=_0x43caac[_0x41a09a];return _0x3b098e;},a672_0x41a0(_0x1443fe,_0x13d97a);}Object[a672_0x373c52(0x98)](exports,a672_0x373c52(0x93),{'value':!![]}),exports[a672_0x373c52(0xa9)]=exports['userMonitor']=void 0x0;const bull_1=__importDefault(require(a672_0x373c52(0xb3))),Sentry=__importStar(require(a672_0x373c52(0xc0))),sequelize_1=require(a672_0x373c52(0x95)),lodash_1=require(a672_0x373c52(0xbe)),logger_1=require(a672_0x373c52(0xbd)),database_1=__importDefault(require(a672_0x373c52(0xbc))),User_1=__importDefault(require(a672_0x373c52(0x9b))),connection=process[a672_0x373c52(0xa5)]['REDIS_URI']||'';exports[a672_0x373c52(0x90)]=new bull_1[(a672_0x373c52(0xaf))](a672_0x373c52(0xb5),connection);async function handleLoginStatus(_0x409e9d){const _0x5874f1=a672_0x373c52,_0x229264=await database_1['default'][_0x5874f1(0x91)](_0x5874f1(0x94),{'type':sequelize_1[_0x5874f1(0xb6)][_0x5874f1(0xb2)]});for(let _0x2ea29d of _0x229264){try{const _0x2c2340=await User_1['default'][_0x5874f1(0x97)](_0x2ea29d['id']);await _0x2c2340[_0x5874f1(0xc2)]({'online':![]}),logger_1[_0x5874f1(0xb1)][_0x5874f1(0xbb)](_0x5874f1(0xa3)+_0x2ea29d['id']);}catch(_0x34c553){Sentry['captureException'](_0x34c553);}}}async function handleUserConnection(_0x56082e){const _0x78b274=a672_0x373c52;try{const {id:_0x44e81b}=_0x56082e[_0x78b274(0x9e)];if(!(0x0,lodash_1['isNil'])(_0x44e81b)&&_0x44e81b!==_0x78b274(0xab)){const _0x365ec1=await User_1[_0x78b274(0xaf)][_0x78b274(0x97)](_0x44e81b);_0x365ec1&&(_0x365ec1[_0x78b274(0x92)]=!![],await _0x365ec1[_0x78b274(0xb8)]());}}catch(_0x2b5091){Sentry[_0x78b274(0xba)](_0x2b5091);}}exports['userMonitor'][a672_0x373c52(0xa1)](a672_0x373c52(0xc1),handleUserConnection),exports['userMonitor'][a672_0x373c52(0xa1)](a672_0x373c52(0x96),handleLoginStatus);async function initUserMonitorQueues(){const _0x3cbdfb=a672_0x373c52,_0x2cddf8=await exports[_0x3cbdfb(0x90)][_0x3cbdfb(0xa7)]();for(let _0xbb6a9b of _0x2cddf8){await exports[_0x3cbdfb(0x90)][_0x3cbdfb(0xa8)](_0xbb6a9b[_0x3cbdfb(0xad)]);}exports[_0x3cbdfb(0x90)]['add'](_0x3cbdfb(0x96),{},{'repeat':{'cron':_0x3cbdfb(0xae),'key':'verify-login-status'},'removeOnComplete':{'age':0x3c*0x3c,'count':0xa},'removeOnFail':{'age':0x3c*0x3c,'count':0xa}}),logger_1[_0x3cbdfb(0xb1)][_0x3cbdfb(0xbb)]('Queue:\x20monitoramento\x20de\x20status\x20de\x20usuário\x20inicializado');}exports['initUserMonitorQueues']=initUserMonitorQueues;