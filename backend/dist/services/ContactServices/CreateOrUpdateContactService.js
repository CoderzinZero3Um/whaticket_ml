'use strict';const a479_0x5b6001=a479_0x2893;(function(_0x5bde54,_0x27f77d){const _0x4e9369=a479_0x2893,_0x4baf99=_0x5bde54();while(!![]){try{const _0x423918=parseInt(_0x4e9369(0x142))/0x1*(-parseInt(_0x4e9369(0x15c))/0x2)+-parseInt(_0x4e9369(0x16d))/0x3*(-parseInt(_0x4e9369(0x163))/0x4)+parseInt(_0x4e9369(0x16c))/0x5+-parseInt(_0x4e9369(0x13d))/0x6*(parseInt(_0x4e9369(0x148))/0x7)+parseInt(_0x4e9369(0x155))/0x8+parseInt(_0x4e9369(0x14a))/0x9+parseInt(_0x4e9369(0x166))/0xa*(-parseInt(_0x4e9369(0x154))/0xb);if(_0x423918===_0x27f77d)break;else _0x4baf99['push'](_0x4baf99['shift']());}catch(_0x78a4da){_0x4baf99['push'](_0x4baf99['shift']());}}}(a479_0x2048,0x7a5ab));function a479_0x2048(){const _0x18d5f6=['error','name','defineProperty','.jpeg','arraybuffer','11HHzrVa','6526256ofeFJg','create','hasOwnProperty','Error\x20to\x20find\x20or\x20create\x20a\x20contact:','../../models/CompaniesSettings','chmodSync','-contact','4348opYxjU','profilePicUrl','remoteJid','__setModuleDefault','findOne','__importStar','axios','4jfCXzM','isNil','configurable','12798010eUxzCi','nopicture.png','getTime','../../libs/socket','urlPicture','enabled','4304315USSOfL','2376831cbKDcP','writeFileSync','__importDefault','update','writable','whatsapp','company-','1992Cbgnlw','contacts','emit','existsSync','data','47ghDGId','default','__esModule','get','__createBinding','join','16849gTAbsX','unlinkSync','1920096uXHWbx','lodash','../../utils/logger','reload','getOwnPropertyDescriptor'];a479_0x2048=function(){return _0x18d5f6;};return a479_0x2048();}var __createBinding=this&&this[a479_0x5b6001(0x146)]||(Object['create']?function(_0x95fb2,_0xae097,_0x2bd61d,_0x1a60f9){const _0x525f6d=a479_0x5b6001;if(_0x1a60f9===undefined)_0x1a60f9=_0x2bd61d;var _0xfd05ed=Object[_0x525f6d(0x14e)](_0xae097,_0x2bd61d);(!_0xfd05ed||(_0x525f6d(0x145)in _0xfd05ed?!_0xae097['__esModule']:_0xfd05ed[_0x525f6d(0x171)]||_0xfd05ed[_0x525f6d(0x165)]))&&(_0xfd05ed={'enumerable':!![],'get':function(){return _0xae097[_0x2bd61d];}}),Object[_0x525f6d(0x151)](_0x95fb2,_0x1a60f9,_0xfd05ed);}:function(_0x1b9a8c,_0x454025,_0x218ebb,_0x206b0b){if(_0x206b0b===undefined)_0x206b0b=_0x218ebb;_0x1b9a8c[_0x206b0b]=_0x454025[_0x218ebb];}),__setModuleDefault=this&&this[a479_0x5b6001(0x15f)]||(Object[a479_0x5b6001(0x156)]?function(_0x35b707,_0x3848b1){const _0x577c27=a479_0x5b6001;Object[_0x577c27(0x151)](_0x35b707,_0x577c27(0x143),{'enumerable':!![],'value':_0x3848b1});}:function(_0x3c06df,_0x56f510){const _0x9ba9ae=a479_0x5b6001;_0x3c06df[_0x9ba9ae(0x143)]=_0x56f510;}),__importStar=this&&this[a479_0x5b6001(0x161)]||function(_0x3730fe){const _0x41554b=a479_0x5b6001;if(_0x3730fe&&_0x3730fe[_0x41554b(0x144)])return _0x3730fe;var _0x5809fa={};if(_0x3730fe!=null){for(var _0x45ae9c in _0x3730fe)if(_0x45ae9c!==_0x41554b(0x143)&&Object['prototype'][_0x41554b(0x157)]['call'](_0x3730fe,_0x45ae9c))__createBinding(_0x5809fa,_0x3730fe,_0x45ae9c);}return __setModuleDefault(_0x5809fa,_0x3730fe),_0x5809fa;},__importDefault=this&&this[a479_0x5b6001(0x16f)]||function(_0x3adc2a){return _0x3adc2a&&_0x3adc2a['__esModule']?_0x3adc2a:{'default':_0x3adc2a};};Object[a479_0x5b6001(0x151)](exports,a479_0x5b6001(0x144),{'value':!![]});function a479_0x2893(_0x58b10,_0x36b54a){const _0x204836=a479_0x2048();return a479_0x2893=function(_0x289339,_0x38f42b){_0x289339=_0x289339-0x13d;let _0x37f628=_0x204836[_0x289339];return _0x37f628;},a479_0x2893(_0x58b10,_0x36b54a);}const socket_1=require(a479_0x5b6001(0x169)),CompaniesSettings_1=__importDefault(require(a479_0x5b6001(0x159))),Contact_1=__importDefault(require('../../models/Contact')),fs_1=__importDefault(require('fs')),path_1=__importStar(require('path')),logger_1=require(a479_0x5b6001(0x14c)),lodash_1=require(a479_0x5b6001(0x14b)),axios=require(a479_0x5b6001(0x162)),CreateOrUpdateContactService=async({name:_0x19c398,number:_0x275eaf,profilePicUrl:_0x5a54db,isGroup:_0x15407c,email:email='',channel:channel=a479_0x5b6001(0x172),companyId:_0x3dff07,extraInfo:extraInfo=[],remoteJid:remoteJid='',whatsappId:_0x2380bc})=>{const _0x2eff29=a479_0x5b6001;try{let _0x4a5024=![];const _0x5463b6=path_1[_0x2eff29(0x143)]['resolve'](__dirname,'..','..','..','public'),_0x2c4e2b=_0x15407c?_0x275eaf:_0x275eaf['replace'](/[^0-9]/g,''),_0x43d0d6=(0x0,socket_1['getIO'])();let _0x3584f1;_0x3584f1=await Contact_1['default'][_0x2eff29(0x160)]({'where':{'number':_0x2c4e2b,'companyId':_0x3dff07}});const _0x44573f=_0x3584f1?.[_0x2eff29(0x15d)]!==_0x5a54db&&_0x5a54db!==''||![];if(_0x3584f1)_0x3584f1[_0x2eff29(0x15e)]=remoteJid,_0x3584f1['profilePicUrl']=_0x5a54db||null,(0x0,lodash_1[_0x2eff29(0x164)])(_0x3584f1['whatsappId'])&&_0x3584f1['update']({'whatsappId':_0x2380bc}),(_0x15407c||_0x3584f1[_0x2eff29(0x150)]===_0x2c4e2b)&&(_0x3584f1[_0x2eff29(0x150)]=_0x19c398),await _0x3584f1['save'](),await _0x3584f1['reload']();else{const _0x4e09c3=await CompaniesSettings_1['default'][_0x2eff29(0x160)]({'where':{'companyId':_0x3dff07}}),{acceptAudioMessageContact:_0x93a586}=_0x4e09c3;_0x3584f1=await Contact_1[_0x2eff29(0x143)]['create']({'name':_0x19c398,'number':_0x2c4e2b,'email':email,'isGroup':_0x15407c,'extraInfo':extraInfo,'companyId':_0x3dff07,'channel':channel,'acceptAudioMessage':_0x93a586===_0x2eff29(0x16b)?!![]:![],'remoteJid':remoteJid,'urlPicture':_0x5a54db,'whatsappId':_0x2380bc}),_0x4a5024=!![];}if(_0x44573f){const _0x27fe04=path_1[_0x2eff29(0x143)]['resolve'](_0x5463b6,'company'+_0x3dff07,_0x2eff29(0x13e));!fs_1[_0x2eff29(0x143)][_0x2eff29(0x140)](_0x27fe04)&&(fs_1[_0x2eff29(0x143)]['mkdirSync'](_0x27fe04,{'recursive':!![]}),fs_1[_0x2eff29(0x143)][_0x2eff29(0x15a)](_0x27fe04,0x1ff));let _0x51bb39;if(!(0x0,lodash_1[_0x2eff29(0x164)])(_0x5a54db)&&_0x5a54db['includes']('nopicture'))_0x51bb39=_0x2eff29(0x167);else{if(!(0x0,lodash_1[_0x2eff29(0x164)])(_0x3584f1[_0x2eff29(0x16a)])){const _0x164bd1=path_1[_0x2eff29(0x143)]['resolve'](_0x3584f1[_0x2eff29(0x16a)]);fs_1['default']['existsSync'](_0x164bd1)&&fs_1['default'][_0x2eff29(0x149)](_0x164bd1);}const _0xc52132=await axios['get'](_0x5a54db,{'responseType':_0x2eff29(0x153)});_0x51bb39=''+_0x3584f1['id']+new Date()[_0x2eff29(0x168)]()+_0x2eff29(0x152),fs_1[_0x2eff29(0x143)][_0x2eff29(0x16e)]((0x0,path_1[_0x2eff29(0x147)])(_0x27fe04,_0x51bb39),_0xc52132[_0x2eff29(0x141)]);}await _0x3584f1[_0x2eff29(0x170)]({'urlPicture':_0x51bb39,'pictureUpdated':!![]}),await _0x3584f1[_0x2eff29(0x14d)]();}return _0x4a5024?_0x43d0d6['emit'](_0x2eff29(0x173)+_0x3dff07+_0x2eff29(0x15b),{'action':'create','contact':_0x3584f1}):_0x43d0d6[_0x2eff29(0x13f)](_0x2eff29(0x173)+_0x3dff07+_0x2eff29(0x15b),{'action':'update','contact':_0x3584f1}),_0x3584f1;}catch(_0x105f49){logger_1['logger'][_0x2eff29(0x14f)](_0x2eff29(0x158),_0x105f49);throw _0x105f49;}};exports[a479_0x5b6001(0x143)]=CreateOrUpdateContactService;